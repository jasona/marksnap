<Window x:Class="MarkSnap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="MarkSnap - Markdown Viewer"
        Height="800"
        Width="1000"
        MinHeight="400"
        MinWidth="600"
        WindowStartupLocation="Manual"
        WindowStyle="None"
        Background="{DynamicResource WindowBackgroundBrush}"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver"
        DragLeave="Window_DragLeave"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.Open}"/>
        <KeyBinding Key="W" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.Close}"/>
        <KeyBinding Key="F5" Command="{x:Static NavigationCommands.Refresh}"/>
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{x:Static NavigationCommands.Refresh}"/>
    </Window.InputBindings>

    <Window.CommandBindings>
        <CommandBinding Command="{x:Static ApplicationCommands.Open}" Executed="OpenCommand_Executed"/>
        <CommandBinding Command="{x:Static ApplicationCommands.Close}" Executed="CloseCommand_Executed"/>
        <CommandBinding Command="{x:Static NavigationCommands.Refresh}" Executed="RefreshCommand_Executed"/>
    </Window.CommandBindings>

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      GlassFrameThickness="0"
                      ResizeBorderThickness="5"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Border Grid.Row="0" Background="{DynamicResource TitleBarBackgroundBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- App Icon and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="M" FontWeight="Bold" FontSize="14" Foreground="{DynamicResource AccentBrush}"
                               VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock x:Name="TitleBarText" Text="MarkSnap" FontSize="12"
                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Window Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="MinimizeButton" Content="&#xE921;"
                            Style="{StaticResource WindowButtonStyle}"
                            Click="MinimizeButton_Click"/>
                    <Button x:Name="MaximizeButton" Content="&#xE922;"
                            Style="{StaticResource WindowButtonStyle}"
                            Click="MaximizeButton_Click"/>
                    <Button x:Name="CloseButton" Content="&#xE8BB;"
                            Style="{StaticResource CloseButtonStyle}"
                            Click="CloseButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{DynamicResource ToolbarBackgroundBrush}" Padding="10,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="OpenButton" Content="Open" Click="OpenButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" Margin="0,0,8,0"/>
                    <Button x:Name="RefreshButton" Content="Refresh" Click="RefreshButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" Margin="0,0,8,0"/>
                    <Button x:Name="CloseTabButton" Content="Close Tab" Click="CloseTabButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}"/>
                </StackPanel>

                <TextBlock x:Name="FileNameText" Grid.Column="1"
                           Text="No file loaded"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           FontSize="13"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="SettingsButton" Content="Settings" Click="SettingsButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" Margin="0,0,8,0"/>
                    <Button x:Name="RegisterButton" Content="Set as Default" Click="RegisterButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" ToolTip="Register MarkSnap as the default .md file handler"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tab Control for multiple documents -->
        <TabControl x:Name="DocumentTabs" Grid.Row="2"
                    Background="{DynamicResource WindowBackgroundBrush}"
                    BorderThickness="0"
                    SelectionChanged="DocumentTabs_SelectionChanged"
                    Visibility="Collapsed">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="TabBorder"
                                        Background="{DynamicResource ToolbarBackgroundBrush}"
                                        BorderThickness="1,1,1,0"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        Margin="2,2,0,0"
                                        CornerRadius="4,4,0,0">
                                    <StackPanel Orientation="Horizontal" Margin="10,6">
                                        <TextBlock x:Name="TabText"
                                                   Text="{TemplateBinding Header}"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   VerticalAlignment="Center"
                                                   MaxWidth="150"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <Button x:Name="CloseBtn" Content="&#xE8BB;"
                                                FontFamily="Segoe MDL2 Assets"
                                                FontSize="8"
                                                Margin="8,0,0,0"
                                                Padding="4,2"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Foreground="{DynamicResource TextSecondaryBrush}"
                                                Cursor="Hand"
                                                Click="TabCloseButton_Click"
                                                WindowChrome.IsHitTestVisibleInChrome="True"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource WindowBackgroundBrush}"/>
                                        <Setter TargetName="TabText" Property="Foreground" Value="{DynamicResource TextHeadingBrush}"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                    </Trigger>
                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource Self}}" Value="True">
                                        <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource WindowBackgroundBrush}"/>
                                    </DataTrigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>
        </TabControl>

        <!-- Welcome panel (shown when no tabs are open) -->
        <Border x:Name="WelcomePanel" Grid.Row="2" Background="{DynamicResource WindowBackgroundBrush}" Visibility="Visible"
                AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" IsHitTestVisible="False">
                <TextBlock Text="MarkSnap" Foreground="{DynamicResource TextHeadingBrush}" FontSize="32" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                <TextBlock Text="Markdown Viewer" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="16" HorizontalAlignment="Center" Margin="0,5,0,30"/>
                <TextBlock Text="Drop a .md file here or click Open to get started"
                           Foreground="{DynamicResource TextMutedBrush}" FontSize="14" HorizontalAlignment="Center"/>
                <TextBlock Text="You can also double-click .md files after registering MarkSnap as the default handler"
                           Foreground="{DynamicResource TextMutedBrush}" FontSize="12" HorizontalAlignment="Center" Margin="0,10,0,0" Opacity="0.7"/>
            </StackPanel>
        </Border>

        <!-- Invisible drop zone overlay (on top of tabs when content is loaded) -->
        <Border x:Name="DropZone" Grid.Row="2" Background="Transparent"
                AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver"
                IsHitTestVisible="False"/>

        <!-- Status bar -->
        <Border Grid.Row="3" Background="{DynamicResource AccentBrush}" Padding="10,4">
            <TextBlock x:Name="StatusText" Text="Ready" Foreground="White" FontSize="12"/>
        </Border>
    </Grid>
</Window>
