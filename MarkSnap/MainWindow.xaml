<Window x:Class="MarkSnap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="MarkSnap - Markdown Viewer"
        Height="800"
        Width="1000"
        MinHeight="400"
        MinWidth="600"
        WindowStartupLocation="Manual"
        WindowStyle="None"
        Background="{DynamicResource WindowBackgroundBrush}"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver"
        DragLeave="Window_DragLeave">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      GlassFrameThickness="0"
                      ResizeBorderThickness="5"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Border Grid.Row="0" Background="{DynamicResource TitleBarBackgroundBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- App Icon and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="M" FontWeight="Bold" FontSize="14" Foreground="{DynamicResource AccentBrush}"
                               VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock x:Name="TitleBarText" Text="MarkSnap" FontSize="12"
                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Window Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="MinimizeButton" Content="&#xE921;"
                            Style="{StaticResource WindowButtonStyle}"
                            Click="MinimizeButton_Click"/>
                    <Button x:Name="MaximizeButton" Content="&#xE922;"
                            Style="{StaticResource WindowButtonStyle}"
                            Click="MaximizeButton_Click"/>
                    <Button x:Name="CloseButton" Content="&#xE8BB;"
                            Style="{StaticResource CloseButtonStyle}"
                            Click="CloseButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{DynamicResource ToolbarBackgroundBrush}" Padding="10,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="OpenButton" Content="Open" Click="OpenButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" Margin="0,0,8,0"/>
                    <Button x:Name="RefreshButton" Content="Refresh" Click="RefreshButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}"/>
                </StackPanel>

                <TextBlock x:Name="FileNameText" Grid.Column="1"
                           Text="No file loaded"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           FontSize="13"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="SettingsButton" Content="Settings" Click="SettingsButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" Margin="0,0,8,0"/>
                    <Button x:Name="RegisterButton" Content="Set as Default" Click="RegisterButton_Click"
                            Style="{StaticResource ToolbarButtonStyle}" ToolTip="Register MarkSnap as the default .md file handler"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- WebView for Markdown rendering -->
        <wv2:WebView2 x:Name="MarkdownView"
                      Grid.Row="2"
                      DefaultBackgroundColor="#1e1e1e"/>

        <!-- Welcome panel (shown when no file is loaded) -->
        <Border x:Name="WelcomePanel" Grid.Row="2" Background="{DynamicResource WindowBackgroundBrush}" Visibility="Visible"
                AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" IsHitTestVisible="False">
                <TextBlock Text="MarkSnap" Foreground="{DynamicResource TextHeadingBrush}" FontSize="32" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                <TextBlock Text="Markdown Viewer" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="16" HorizontalAlignment="Center" Margin="0,5,0,30"/>
                <TextBlock Text="Drop a .md file here or click Open to get started"
                           Foreground="{DynamicResource TextMutedBrush}" FontSize="14" HorizontalAlignment="Center"/>
                <TextBlock Text="You can also double-click .md files after registering MarkSnap as the default handler"
                           Foreground="{DynamicResource TextMutedBrush}" FontSize="12" HorizontalAlignment="Center" Margin="0,10,0,0" Opacity="0.7"/>
            </StackPanel>
        </Border>

        <!-- Invisible drop zone overlay (on top of WebView2 when content is loaded) -->
        <Border x:Name="DropZone" Grid.Row="2" Background="Transparent"
                AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver"
                IsHitTestVisible="False"/>

        <!-- Status bar -->
        <Border Grid.Row="3" Background="{DynamicResource AccentBrush}" Padding="10,4">
            <TextBlock x:Name="StatusText" Text="Ready" Foreground="White" FontSize="12"/>
        </Border>
    </Grid>
</Window>
